<div class="card">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Registro de Dep贸sitos</h2>
    <button class="btn btn-primary" (click)="showCreateForm()" *ngIf="!showForm">
      Nuevo Dep贸sito
    </button>
  </div>

  <!-- Filtro de usuarios para admin -->
  <app-filtro-usuario-admin (filtroChange)="onFiltroChange($event)"></app-filtro-usuario-admin>

  <!-- Formulario de Nuevo Dep贸sito -->
  <div *ngIf="showForm" class="card mb-3" style="background-color: #f8f9fa;">
    <h3>Nuevo Dep贸sito</h3>
    <form (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>Fecha *</label>
        <input
          type="date"
          class="form-control"
          [value]="formatDate(formData.fecha)"
          (input)="formData.fecha = $any($event.target).value"
          name="fecha"
          required>
      </div>

      <div class="form-group">
        <label>Fondo Monetario *</label>
        <select class="form-control" [(ngModel)]="formData.fondoMonetarioId" name="fondoMonetario" required>
          <option value="0">Seleccione un fondo...</option>
          <option *ngFor="let fondo of fondosMonetarios" [value]="fondo.fondoMonetarioId">
            {{ fondo.nombre }} ({{ fondo.tipoFondo }}) - Saldo: ${{ fondo.saldoActual | number:'1.2-2' }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Monto *</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="formData.monto"
          name="monto"
          min="0.01"
          step="0.01"
          placeholder="0.00"
          required>
        <small class="form-text text-muted">
          El saldo del fondo se incrementar谩 autom谩ticamente con este monto
        </small>
      </div>

      <div class="form-group">
        <label>Descripci贸n</label>
        <textarea
          class="form-control"
          [(ngModel)]="formData.descripcion"
          name="descripcion"
          rows="2"
          placeholder="Descripci贸n opcional del dep贸sito (ej: Ingreso por salario, Transferencia, etc.)"></textarea>
      </div>

      <div class="d-flex" style="gap: 10px;">
        <button
          type="submit"
          class="btn btn-success"
          [disabled]="formData.fondoMonetarioId === 0 || formData.monto <= 0">
          Guardar Dep贸sito
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelForm()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de Dep贸sitos -->
  <div class="depositos-section">
    <h3>Historial de Dep贸sitos</h3>

    <table *ngIf="depositos.length > 0">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Fondo Monetario</th>
          <th>Monto</th>
          <th>Descripci贸n</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let deposito of depositos">
          <td>{{ deposito.fecha | date:'dd/MM/yyyy' }}</td>
          <td>
            <div class="fondo-info">
              <strong>{{ deposito.fondoMonetarioNombre }}</strong>
              <span class="fondo-saldo" *ngIf="getFondoById(deposito.fondoMonetarioId) as fondo">
                Saldo actual: ${{ fondo.saldoActual | number:'1.2-2' }}
              </span>
            </div>
          </td>
          <td class="monto-deposito">
            <span class="badge-deposito">
              +${{ deposito.monto | number:'1.2-2' }}
            </span>
          </td>
          <td>{{ deposito.descripcion || '-' }}</td>
          <td>
            <button
              class="btn btn-danger"
              (click)="deleteDeposito(deposito.depositoId, deposito.fondoMonetarioNombre, deposito.monto)">
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"><strong>Total Depositado:</strong></td>
          <td colspan="3">
            <strong class="total-depositos">
              ${{ calcularTotalDepositos() | number:'1.2-2' }}
            </strong>
          </td>
        </tr>
      </tfoot>
    </table>

    <div *ngIf="depositos.length === 0" class="alert alert-info text-center">
      No hay dep贸sitos registrados. Haga clic en "Nuevo Dep贸sito" para registrar uno.
    </div>
  </div>

  <!-- Informaci贸n adicional -->
  <div class="alert alert-success mt-3">
    <strong> Nota importante:</strong>
    <ul>
      <li>Los dep贸sitos incrementan autom谩ticamente el saldo del fondo seleccionado</li>
      <li>Al eliminar un dep贸sito, el saldo del fondo se reducir谩 autom谩ticamente</li>
      <li>Puede ver el saldo actual de cada fondo en la tabla de dep贸sitos</li>
    </ul>
  </div>
</div>
